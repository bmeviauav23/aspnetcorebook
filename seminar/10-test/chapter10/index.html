
<!DOCTYPE html>

<html class="no-js" lang="hu">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Tóth Tibor, Simon Gábor, Albert István, Szabó Gábor" name="author"/>
<link href="https://bmeviauav23.github.io/aspnetcorebook/seminar/10-test/chapter10/" rel="canonical"/>
<link href="../../08-client/chapter8/" rel="prev"/>
<link href="../../../homework/" rel="next"/>
<link href="../../../favicon.ico" rel="icon"/>
<meta content="mkdocs-1.6.0, mkdocs-material-9.5.27" name="generator"/>
<title>Automatizált tesztelés - BMEVIAUAV23 - Szoftverfejlesztés .NET platformra</title>
<link href="../../../assets/stylesheets/main.6543a935.min.css" rel="stylesheet"/>
<link href="../../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../../css/timeago.css" rel="stylesheet"/>
<link href="../../../extra-material-theme.css" rel="stylesheet"/>
<script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<link href="../../../assets/stylesheets/extra-style.1rn8hjb8.min.css" rel="stylesheet"/> <link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../assets/javascripts/glightbox.min.js"></script></head>
<body data-md-color-accent="red" data-md-color-primary="aut" data-md-color-scheme="aut" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#automatizalt-teszteles">
          Kihagyás
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Élőfej" class="md-header__inner md-grid">
<a aria-label="BMEVIAUAV23 - Szoftverfejlesztés .NET platformra" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="BMEVIAUAV23 - Szoftverfejlesztés .NET platformra">
<img alt="logo" src="../../../logo-bme-aut.png"/>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            BMEVIAUAV23 - Szoftverfejlesztés .NET platformra
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Automatizált tesztelés
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Váltás sötét témára" class="md-option" data-md-color-accent="red" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="aut" data-md-color-scheme="aut" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Váltás sötét témára">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"></path></svg>
</label>
<input aria-label="Váltás világos témára" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="red" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Váltás világos témára">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"></path></svg>
</label>
</form>
<script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Keresés" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Keresés" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Keresés" class="md-search__options">
<button aria-label="Törlés" class="md-search__icon md-icon" tabindex="-1" title="Törlés" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Keresés inicializálása
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/bmeviauav23/aspnetcorebook" title="Főoldalra ugrás">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</div>
<div class="md-source__repository">
    bmeviauav23/aspnetcorebook
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="Lapok" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../..">
          
  
  Tudnivalók

        </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../../01-csharp1/chapter1/">
          
  
  Laborok

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../homework/">
          
  
  Házi feladat

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../information/afterword/">
        
  
    
  
  Zárszó

      </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigáció" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="BMEVIAUAV23 - Szoftverfejlesztés .NET platformra" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="BMEVIAUAV23 - Szoftverfejlesztés .NET platformra">
<img alt="logo" src="../../../logo-bme-aut.png"/>
</a>
    BMEVIAUAV23 - Szoftverfejlesztés .NET platformra
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/bmeviauav23/aspnetcorebook" title="Főoldalra ugrás">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</div>
<div class="md-source__repository">
    bmeviauav23/aspnetcorebook
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
<span class="md-ellipsis">
    Tudnivalók
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_1_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_1">
<span class="md-nav__icon md-icon"></span>
            Tudnivalók
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../..">
<span class="md-ellipsis">
    Szoftverfejlesztés .NET platformra
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../information/preface/">
<span class="md-ellipsis">
    Tudnivalók
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../information/contributing/">
<span class="md-ellipsis">
    Hozzájárulás az anyaghoz
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
<span class="md-ellipsis">
    Laborok
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Laborok
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../01-csharp1/chapter1/">
<span class="md-ellipsis">
    C# alapok, szintaxis
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../02-csharp2/chapter2/">
<span class="md-ellipsis">
    C# alapok II.
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../03-linq/chapter3/">
<span class="md-ellipsis">
    LINQ
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../04-csharp4/chapter4/">
<span class="md-ellipsis">
    C# alapok IV.
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../05-aspnetcore1/chapter5/">
<span class="md-ellipsis">
    ASP.NET Core alapszolgáltatások
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../06-efcore/chapter6/">
<span class="md-ellipsis">
    Entity Framework Core I-II.
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../07-restapi/chapter7/">
<span class="md-ellipsis">
    ASP.NET Core webszolgáltatások I.-II.
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../08-client/chapter8/">
<span class="md-ellipsis">
    ASP.NET Core webszolgáltatások III.
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    Automatizált tesztelés
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    Automatizált tesztelés
  </span>
</a>
<nav aria-label="Tartalomjegyzék" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Tartalomjegyzék
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#segedeszkozok">
<span class="md-ellipsis">
      Segédeszközök
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#bevezetes">
<span class="md-ellipsis">
      Bevezetés
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#automatizalt-teszteles-net-kornyezetben">
<span class="md-ellipsis">
      Automatizált tesztelés .NET környezetben
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#integracios-teszteles">
<span class="md-ellipsis">
      Integrációs tesztelés
    </span>
</a>
<nav aria-label="Integrációs tesztelés" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#teszt-projekt">
<span class="md-ellipsis">
      Teszt projekt
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#teszt-szerver">
<span class="md-ellipsis">
      Teszt szerver
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kontrollertesztek-elokeszitese">
<span class="md-ellipsis">
      Kontrollertesztek előkészítése
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#post-muvelet-alapmukodes-tesztelese">
<span class="md-ellipsis">
      POST művelet alapműködés tesztelése
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#post-muvelet-hibaag-tesztelese">
<span class="md-ellipsis">
      POST művelet hibaág tesztelése
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#naplozas">
<span class="md-ellipsis">
      Naplózás
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    Házi feladat
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            Házi feladat
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../homework/">
<span class="md-ellipsis">
    Házi feladat tudnivalók
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../homework/example-spec/">
<span class="md-ellipsis">
    Példa kisHF specifikáció
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../homework/hw-points/">
<span class="md-ellipsis">
    NagyHF pontrendszer
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../information/afterword/">
<span class="md-ellipsis">
    Zárszó
  </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Tartalomjegyzék" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Tartalomjegyzék
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#segedeszkozok">
<span class="md-ellipsis">
      Segédeszközök
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#bevezetes">
<span class="md-ellipsis">
      Bevezetés
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#automatizalt-teszteles-net-kornyezetben">
<span class="md-ellipsis">
      Automatizált tesztelés .NET környezetben
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#integracios-teszteles">
<span class="md-ellipsis">
      Integrációs tesztelés
    </span>
</a>
<nav aria-label="Integrációs tesztelés" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#teszt-projekt">
<span class="md-ellipsis">
      Teszt projekt
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#teszt-szerver">
<span class="md-ellipsis">
      Teszt szerver
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#kontrollertesztek-elokeszitese">
<span class="md-ellipsis">
      Kontrollertesztek előkészítése
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#post-muvelet-alapmukodes-tesztelese">
<span class="md-ellipsis">
      POST művelet alapműködés tesztelése
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#post-muvelet-hibaag-tesztelese">
<span class="md-ellipsis">
      POST művelet hibaág tesztelése
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#naplozas">
<span class="md-ellipsis">
      Naplózás
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/bmeviauav23/aspnetcorebook/edit/master/docs/seminar/10-test/chapter10.md" title="Oldal szerkesztése">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"></path></svg>
</a>
<h1 id="automatizalt-teszteles">Automatizált tesztelés<a class="headerlink" href="#automatizalt-teszteles" title="Permanent link">¶</a></h1>
<h2 id="segedeszkozok">Segédeszközök<a class="headerlink" href="#segedeszkozok" title="Permanent link">¶</a></h2>
<ul>
<li>kapcsolódó GitHub repo: <a href="https://github.com/bmeviauav23/WebApiLab-kiindulo">https://github.com/bmeviauav23/WebApiLab-kiindulo</a></li>
</ul>
<h2 id="bevezetes">Bevezetés<a class="headerlink" href="#bevezetes" title="Permanent link">¶</a></h2>
<p>Az automatizált tesztelés az alkalmazásfejlesztés egyik fontos lépése, mivel ezzel tudunk meggyőződni arról, hogy egy-egy funkció akkor is helyesen működik, ha az alkalmazás egy másik részén valamit módosítunk.
Hogy ezt az ellenőrzést ne kelljen minden egyes alkalommal manuálisan végrehajtani az alkalmazáson, programozott teszteket szoktunk írni, amelyek futtatását CI/CD folyamatokban automatizálhatjuk.</p>
<p>A tesztek több típusát ismerhetjük:</p>
<ul>
<li><strong>Unit test (egységteszt)</strong> célja, hogy egy adott osztály egy metódusának a viselkedését önmagába vizsgáljuk úgy, hogy a függőségeit <a href="https://learn.microsoft.com/en-us/dotnet/core/testing/unit-testing-best-practices#lets-speak-the-same-language">mock/fake objektumokkal</a> helyettesítjük, hogy azok a tesztesetnek megfelelően viselkedjenek vagy megfigyelhetőek legyenek.</li>
<li><strong>Integrációs teszt / End-2-end teszt / funkcionális teszt</strong> esetében a célunk, hogy a teljes rendszert meghajtsuk úgy, hogy az integrációk (SQL kapcsolat, egyéb szolgáltatások) is tesztelésre kerülnek, illetve a BE szempontjából vizsgáljuk azt is, hogy a rendszer interfésze helyesen válaszol-e a különböző kérésekre.</li>
<li><strong>UI teszt</strong> esetében azt vizsgáljuk, hogy a felhasználói felület a különböző felhasználói interakciókra, eseményekre helyesen rajzolja-e ki az elvárt felületeket.</li>
</ul>
<p>A fenti tesztelési módok mindegyike fontos, de érdemes egy olyan egészséges egyensúlyt megtalálni, ahol a lehető legjobban lefedhetőek a legfontosabb funkcionalitások különböző tesztesetekkel.</p>
<h2 id="automatizalt-teszteles-net-kornyezetben">Automatizált tesztelés .NET környezetben<a class="headerlink" href="#automatizalt-teszteles-net-kornyezetben" title="Permanent link">¶</a></h2>
<p>Automatizált tesztelésre több keretrendszer is használható .NET környezetben, de ASP.NET Core alkalmazások esetében a legelterjedtebb ilyen könyvtár az <a href="https://xunit.net/"><strong>xUnit</strong></a>.
Ebben a keretrendszerben lehetőségünk van tesztesetek definiálására, akár a bemenetek variálásával is, illetve kellően rugalmas, ahhoz, hogy a tesztek feldolgozási mechanizmusa kiterjeszthető legyen.</p>
<p>Unit tesztek esetében az osztályok függőségeit le kell cseréljük, amire több library is lehetőséget nyújt.
A legelterjedtebbek a <a href="https://github.com/moq"><strong>Moq</strong></a> és az <a href="https://nsubstitute.github.io/"><strong>NSubstitute</strong></a>.</p>
<p>Gyakran szükséges funkció, hogy a bemenő adatok előállítása során szeretnénk a valóságra hasonlító véletlenszerű/generált példaadatokat megadni.
Ehhez egy bevált osztálykönyvtár a <a href="https://github.com/bchavez/Bogus"><strong>Bogus</strong></a>.</p>
<p>A tesztesetek elvárt eredményének a vizsgálatát asszertálásnak nevezzük (<em>assert</em>), aminek az írásához nagy segítséget tud nyújtani a <a href="https://fluentassertions.com"><strong>Fluent Assertions</strong></a> könyvtár.
Ez nem csak a szintaktikát teszi olvashatóbbá fluent szintakszissal, hanem több olyan beépített segédlogikát tartalmaz, amivel tömörebbé tehető az <em>assert</em> logika (pl.: objektumok mélységi összehasonlítása érték szerint).</p>
<h2 id="integracios-teszteles">Integrációs tesztelés<a class="headerlink" href="#integracios-teszteles" title="Permanent link">¶</a></h2>
<p>Ezen gyakorlat keretében csak integrációs teszteket fogunk készíteni.</p>
<h3 id="teszt-projekt">Teszt projekt<a class="headerlink" href="#teszt-projekt" title="Permanent link">¶</a></h3>
<p>Vegyünk fel a solutionbe egy új xUnit (.NET 8) típusú projektet <code>WebApiLab.Tests</code> néven. A létrejövő tesztosztályt és fájlját nevezzük át <code>ProductControllerTests</code> névre. Ide fogjuk a <code>ProductController</code>-hez kapcsolódó műveletekre vonatkozó integrációs teszteket készíteni.</p>
<p>Vegyük fel az alábbi NuGet csomagokat a teszt projektbe.
A <em>Bogus*ról és a *Fluent Assertions*ről már volt szó.
A *Microsoft.AspNetCore.Mvc.Testing</em> csomag olyan segédszolgáltatásokat nyújt, amivel integrációs tesztekhez egy in-process teszt szervert tudunk futtatni, és ennek a meghívásában is segítséget nyújt.
A projektfájlban a többi <code>PackageReference</code> mellé (menu:a projekten jobbklikk[Edit Project File]):</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;PackageReference</span><span class="w"> </span><span class="na">Include=</span><span class="s">"Bogus"</span><span class="w"> </span><span class="na">Version=</span><span class="s">"35.5.1"</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;PackageReference</span><span class="w"> </span><span class="na">Include=</span><span class="s">"FluentAssertions"</span><span class="w"> </span><span class="na">Version=</span><span class="s">"6.12.0"</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;PackageReference</span><span class="w"> </span><span class="na">Include=</span><span class="s">"Microsoft.AspNetCore.Mvc.Testing"</span><span class="w"> </span><span class="na">Version=</span><span class="s">"8.0.4"</span><span class="w"> </span><span class="nt">/&gt;</span>
</code></pre></div>
<p>Vegyük fel az <strong>Api</strong> projektet projekt referenciaként a teszt projektbe. A projektfájlban egy másik <code>ItemGroup</code> mellé:</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;ItemGroup&gt;</span>
<span class="w">  </span><span class="nt">&lt;ProjectReference</span><span class="w"> </span><span class="na">Include=</span><span class="s">"..\WebApiLab.Api\WebApiLab.Api.csproj"</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/ItemGroup&gt;</span>
</code></pre></div>
<h3 id="teszt-szerver">Teszt szerver<a class="headerlink" href="#teszt-szerver" title="Permanent link">¶</a></h3>
<p>A tesztszervernek meg kell tudnunk mondani, hogy melyik osztály adja az alkalmazásunk belépési pontját.
Viszont mivel top level statement szintaktikájú a <code>Program</code> osztályunk, annak láthatósága internal, ami a tesztelés szempontjából nem szerencsés (a hasonló esetekben alkalmazott <code>InternalsVisibleTo</code> sem lenne <a href="https://stackoverflow.com/a/69483450/1406798">ebben az esetben megoldás</a>).
Helyette tegyük a <code>Program</code> osztályt publikussá egy <code>partial</code> deklarációval.
Vegyük fel az alábbi partial kiegészítést az API projektben a legfelső szintű kód végére:</p>
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="k">partial</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Program</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<p>Az integrációs tesztünkhöz az in-process teszt szervert egy <code>WebApplicationFactory&lt;TEntryPoint&gt;</code> leszármazott osztály fogja létrehozni.
Ez a segéd ősosztály a fenti Microsoft.AspNetCore.Mvc.Testing csomagból jön.
Itt lehetőségünk van a teszt szerverünket konfigurálni, így akár a DI konfigurációt is.</p>
<p>Hozzunk létre egy osztályt a teszt projektbe <code>CustomWebApplicationFactory</code> néven, ami származzon a <code>WebApplicationFactory&lt;Program&gt;</code> osztályból és definiáljuk felül a <code>CreateHost</code> metódusát.</p>
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">CustomWebApplicationFactory</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">WebApplicationFactory</span><span class="o">&lt;</span><span class="n">Program</span><span class="o">&gt;</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">protected</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="n">IHost</span><span class="w"> </span><span class="nf">CreateHost</span><span class="p">(</span><span class="n">IHostBuilder</span><span class="w"> </span><span class="n">builder</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">builder</span><span class="p">.</span><span class="n">UseEnvironment</span><span class="p">(</span><span class="s">"Development"</span><span class="p">);</span>
<span class="w">        </span><span class="n">builder</span><span class="p">.</span><span class="n">ConfigureServices</span><span class="p">(</span><span class="n">services</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">services</span><span class="p">.</span><span class="n">AddScoped</span><span class="p">(</span><span class="n">sp</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">DbContextOptionsBuilder</span><span class="o">&lt;</span><span class="n">AppDbContext</span><span class="o">&gt;</span><span class="p">()</span>
<span class="w">                </span><span class="p">.</span><span class="n">UseSqlServer</span><span class="p">(</span><span class="s">@"connection string"</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">UseApplicationServiceProvider</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="n">Options</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="kt">var</span><span class="w"> </span><span class="n">host</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">base</span><span class="p">.</span><span class="n">CreateHost</span><span class="p">(</span><span class="n">builder</span><span class="p">);</span>

<span class="w">        </span><span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">scope</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">host</span><span class="p">.</span><span class="n">Services</span><span class="p">.</span><span class="n">CreateScope</span><span class="p">();</span>
<span class="w">        </span><span class="n">scope</span><span class="p">.</span><span class="n">ServiceProvider</span><span class="p">.</span><span class="n">GetRequiredService</span><span class="o">&lt;</span><span class="n">AppDbContext</span><span class="o">&gt;</span><span class="p">()</span>
<span class="w">            </span><span class="p">.</span><span class="n">Database</span><span class="p">.</span><span class="n">EnsureCreated</span><span class="p">();</span>

<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">host</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Megfigyelhetjük, hogy itt is LocalDB-t használunk (mivel integrációs teszt), de a connection stringet lecseréjük a DI konfigurációban. A connection string alapvetően egyezhet a tesztelendő projektben használttal, csak az adatbázisnevet változtassuk meg.
Az adatbázis automatikusan létrejön és a migrációk is lefutnak az <code>EnsureCreated</code> meghívásával - az első lefutáskor.</p>
<div class="admonition warning">
<p class="admonition-title">DI Scope létrehozása</p>
<p>Mivel az <code>AppDbContext</code> Scoped életciklussal van regisztrálva a DI-ba, szükséges létrehozni egy scope-ot, hogy el tudjuk kérni a DI konténertől.
Ezt természetesen ha HTTP kérés közben lennénk az ASP.NET Core automatikusan megtenné.</p>
</div>
<h3 id="kontrollertesztek-elokeszitese">Kontrollertesztek előkészítése<a class="headerlink" href="#kontrollertesztek-elokeszitese" title="Permanent link">¶</a></h3>
<p>Alakítsuk át a <code>ProductControllerTests</code> osztályt.
Az osztály valósítsa meg az <code>IClassFixture&lt;CustomWebApplicationFactory&gt;</code> interfészt, amivel azt tudjuk jelezni az xUnit-nak, hogy kezelje a <code>CustomWebApplicationFactory</code> életciklusát (tesztek között <a href="https://xunit.net/docs/shared-context#class-fixture">megosztott objektum</a> lesz), illetve pluszban lehetőségünk van ezt a tesztosztályokban konstruktoron keresztül elkérni.</p>
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="k">partial</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ProductControllerTests</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">IClassFixture</span><span class="o">&lt;</span><span class="n">CustomWebApplicationFactory</span><span class="o">&gt;</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">WebApplicationFactory</span><span class="o">&lt;</span><span class="n">Program</span><span class="o">&gt;</span><span class="w"> </span><span class="n">_appFactory</span><span class="p">;</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">ProductControllerTests</span><span class="p">(</span><span class="n">CustomWebApplicationFactory</span><span class="w"> </span><span class="n">appFactory</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">_appFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">appFactory</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">xUnit Fixture</p>
<p>Az xUnit nem tartalmaz DI konténert.
Csak azok a konstruktorparaméterek töltődnek ki, amelyek a dokumentációban megtalálhatók.
A <code>CustomWebApplicationFactory</code> típusú paraméter azért töltődik ki, mert az osztály az interfészében jelzi, hogy megosztott kontextusként <code>CustomWebApplicationFactory</code>-t vár.</p>
</div>
<p>Hozzunk létre a Bogus könyvtárral egy olyan <code>Faker&lt;Product&gt;</code> objektumot, amivel az API-nak küldendő DTO objektum generálását végezzük el.
Azonosítóként küldjünk 0 értéket, mivel a létrehozás műveletet fogjuk tesztelni, kategória esetében pedig az 1-et, mivel a migráció által létrehozott 1-es kategóriát fogjuk tudni csak használni.
A többi esetben használjuk a Bogus beépített lehetőségeit a név és a szám értékek random generálásához.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// ...</span>
<span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">Faker</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span><span class="w"> </span><span class="n">_dtoFaker</span><span class="p">;</span>

<span class="k">public</span><span class="w"> </span><span class="nf">ProductControllerTests</span><span class="p">(</span><span class="n">CustomWebApplicationFactory</span><span class="w"> </span><span class="n">appFactory</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="w">    </span><span class="n">_dtoFaker</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Faker</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span><span class="p">()</span>
<span class="w">        </span><span class="p">.</span><span class="n">RuleFor</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">RuleFor</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">Commerce</span><span class="p">.</span><span class="n">Product</span><span class="p">())</span>
<span class="w">        </span><span class="p">.</span><span class="n">RuleFor</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">UnitPrice</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">Random</span><span class="p">.</span><span class="n">Int</span><span class="p">(</span><span class="m">200</span><span class="p">,</span><span class="w"> </span><span class="m">20000</span><span class="p">))</span>
<span class="w">        </span><span class="p">.</span><span class="n">RuleFor</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">ShipmentRegion</span><span class="p">,</span>
<span class="w">                 </span><span class="n">f</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">PickRandom</span><span class="o">&lt;</span><span class="n">Dal</span><span class="p">.</span><span class="n">Entities</span><span class="p">.</span><span class="n">ShipmentRegion</span><span class="o">&gt;</span><span class="p">())</span>
<span class="w">        </span><span class="p">.</span><span class="n">RuleFor</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">CategoryId</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">RuleFor</span><span class="p">(</span><span class="n">p</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">RowVersion</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">f</span><span class="p">.</span><span class="n">Random</span><span class="p">.</span><span class="n">Bytes</span><span class="p">(</span><span class="m">5</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div>
<p>A kliensoldali JSON sorosítást a szerveroldallal kompatibilisen kell megtegyük.
Ehhez készítsünk egy <code>JsonSerializerOptions</code> objektumot, amibe beállítjuk, hogy a felsorolt típusokat szöveges értékként kezelje.
Mivel ugyanazt a példányt akarjuk használni a tesztekben, ezért a példányt a <code>CustomWebApplicationFactory</code> (mint tesztek közötti megosztott objektum) készítse el és ajánlja ki.</p>
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="n">JsonSerializerOptions</span><span class="w"> </span><span class="n">SerializerOptions</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>

<span class="k">public</span><span class="w"> </span><span class="nf">CustomWebApplicationFactory</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">JsonSerializerOptions</span><span class="w"> </span><span class="n">jso</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="p">(</span><span class="n">JsonSerializerDefaults</span><span class="p">.</span><span class="n">Web</span><span class="p">);</span>
<span class="w">    </span><span class="n">jso</span><span class="p">.</span><span class="n">Converters</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">JsonStringEnumConverter</span><span class="p">());</span>
<span class="w">    </span><span class="n">SerializerOptions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">jso</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>A <code>ProductControllerTests</code> a kiajánlott <code>JsonSerializerOptions</code>-t vegye át.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// ...</span>
<span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">JsonSerializerOptions</span><span class="w"> </span><span class="n">_serializerOptions</span><span class="p">;</span>

<span class="k">public</span><span class="w"> </span><span class="nf">ProductControllerTests</span><span class="p">(</span><span class="n">CustomWebApplicationFactory</span><span class="w"> </span><span class="n">appFactory</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="w">    </span><span class="n">_serializerOptions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">appFactory</span><span class="p">.</span><span class="n">SerializerOptions</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Sorosítás beállításai</p>
<p>Sajnos ezt a <code>JsonSerializerOptions</code> példányt minden sorosítást igénylő műveletnél majd át kell adnunk, mivel az alapértelmezett JSON sorosítónak <a href="https://github.com/dotnet/runtime/issues/31094">nincs publikusan elérhető API-ja</a> alapértelmezett sorosítási beállítások megadásához.
Ugyanakkor fontos, hogy kerüljük a <code>JsonSerializerOptions</code> <a href="https://learn.microsoft.com/en-us/dotnet/standard/serialization/system-text-json/configure-options?pivots=dotnet-6-0#reuse-jsonserializeroptions-instances">felesleges példányosítását</a>.
Ugyanolyan beállításokat igénylő műveletek lehetőleg ugyanazt a példányt használják.
Ezt most az XUnit megosztott kontextusával oldottuk meg.</p>
</div>
<h3 id="post-muvelet-alapmukodes-tesztelese">POST művelet alapműködés tesztelése<a class="headerlink" href="#post-muvelet-alapmukodes-tesztelese" title="Permanent link">¶</a></h3>
<p>Készítsük el az első tesztünket a <code>ProductController</code> <code>Post</code> műveletéhez.
Érdemes azt az osztálystruktúrát követni, hogy minden művelethez / függvényhez külön teszt osztályokat hozunk létre, ami akár több tesztesetet is tartalmazhat.
Ez a teszt osztályt beágyazott osztályként (<code>Post</code>) hozzuk létre egy külön partial fájlban (<strong>ProductIntegrationTests.Post.cs</strong>) a nagyobb egységhez tartozó tesztosztályon belül.
Ezzel szépen strukturáltan tudjuk tartani a <strong>Test Explorerben</strong> (lásd később) is a teszteseteinket.
Pluszban még származtassuk le a tartalmazó osztályból, hogy a tesztesetek elérhessék a fentebb létrehozott osztályváltozókat.</p>
<div class="admonition tip">
<p class="admonition-title">Láthatóság beágyazott osztályoknál</p>
<p>Érdekesség, hogy nem kell <code>protected</code> láthatóságúaknak lenniük a fenti osztályváltozóknak, ha beágyazott osztály akarja elérni azokat.</p>
</div>
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="k">partial</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ProductControllerTests</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">//...</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Post</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">ProductControllerTests</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="nf">Post</span><span class="p">(</span><span class="n">CustomWebApplicationFactory</span><span class="w"> </span><span class="n">appFactory</span><span class="p">)</span>
<span class="w">            </span><span class="p">:</span><span class="w"> </span><span class="k">base</span><span class="p">(</span><span class="n">appFactory</span><span class="p">)</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>A tesztesetek a teszt osztályban metódusok fogják reprezentálni, amelyek <code>[Fact]</code> vagy <code>[Theory]</code> attribútummal rendelkeznek.
A fő különbég az, hogy a <code>Fact</code> egy statikus tesztesetet reprezentál, míg a <code>Theory</code> bemenő paraméterekkel rendelkezhet.</p>
<p>Elsőként az egyenes ágat teszteljük le, hogy a beszúrás helyesen lefut-e, és a megfelelő HTTP válaszkódot, a <em>location</em> HTTP fejlécet, és válasz DTO-t adja-e vissza. 
Hozzunk létre egy függvényt <code>Fact</code> attribútummal <code>Should_Succeded_With_Created</code> néven.</p>
<p>A teszteset az <a href="https://learn.microsoft.com/en-us/visualstudio/test/unit-test-basics?view=vs-2022#write-your-tests">AAA (Arrange, Act, Assert)</a> mintát követi, ahol 3 részre tagoljuk magát a tesztesetet.</p>
<ol>
<li>Az <em>Arrange</em> fázisban előkészítjük a teszteset körülményeit.</li>
<li>Az <em>Act</em> fázisban elvégezzük a tesztelendő műveletet.</li>
<li>Az <em>Assert</em> fázisban pedig megvizsgáljuk a végrehajtott művelet eredményeit, mellékhatásait.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="na">[Fact]</span>
<span class="k">public</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="nf">Should_Succeded_With_Created</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Arrange</span>

<span class="w">    </span><span class="c1">// Act</span>

<span class="w">    </span><span class="c1">// Assert</span>
<span class="p">}</span>
</code></pre></div>
<p>Az <em>Arrage</em>-ben kérjünk el egy a teszt szerverhez kapcsolódó <code>HttpClient</code> objektumot, illetve hozzunk létre egy felküldendő DTO-t.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Arrange</span>
<span class="kt">var</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_appFactory</span><span class="p">.</span><span class="n">CreateClient</span><span class="p">();</span>
<span class="kt">var</span><span class="w"> </span><span class="n">dto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_dtoFaker</span><span class="p">.</span><span class="n">Generate</span><span class="p">();</span>
</code></pre></div>
<p>Az <em>Act</em> fázisban küldjünk el egy POST kérést a megfelelő végpontra a megfelelő sorosítási beállításokkal és olvassuk ki a választ.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Act</span>
<span class="kt">var</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="n">client</span><span class="p">.</span><span class="n">PostAsJsonAsync</span><span class="p">(</span><span class="s">"/api/products"</span><span class="p">,</span><span class="w"> </span><span class="n">dto</span><span class="p">,</span><span class="w"> </span><span class="n">_serializerOptions</span><span class="p">);</span>
<span class="kt">var</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="n">response</span><span class="p">.</span><span class="n">Content</span><span class="p">.</span><span class="n">ReadFromJsonAsync</span><span class="o">&lt;</span><span class="n">Product</span><span class="o">&gt;</span><span class="p">(</span><span class="n">_serializerOptions</span><span class="p">);</span>
</code></pre></div>
<p>Az <em>Assert</em> fázisban pedig fogalmazzuk meg a FluentValidation könyvtár segítségével az elvárt eredmény szabályait.
Gondoljunk arra is, hogy a <code>Category</code>, <code>Order</code>, <code>Id</code> és <code>RowVersion</code> property-k esetében nem az az elvárt válasz, amit felküldünk a szerverre, ezért ezeket szűrjük le az összehasonlításból és vizsgáljuk őket külön szabállyal.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Assert</span>
<span class="n">response</span><span class="p">.</span><span class="n">StatusCode</span><span class="p">.</span><span class="n">Should</span><span class="p">().</span><span class="n">Be</span><span class="p">(</span><span class="n">HttpStatusCode</span><span class="p">.</span><span class="n">Created</span><span class="p">);</span>
<span class="n">response</span><span class="p">.</span><span class="n">Headers</span><span class="p">.</span><span class="n">Location</span>
<span class="w">    </span><span class="p">.</span><span class="n">Should</span><span class="p">().</span><span class="n">Be</span><span class="p">(</span>
<span class="w">        </span><span class="k">new</span><span class="w"> </span><span class="nf">Uri</span><span class="p">(</span><span class="n">_appFactory</span><span class="p">.</span><span class="n">Server</span><span class="p">.</span><span class="n">BaseAddress</span><span class="p">,</span><span class="w"> </span><span class="s">$"/api/Products/{p.Id}"</span><span class="p">)</span>
<span class="w">    </span><span class="p">);</span>

<span class="n">p</span><span class="p">.</span><span class="n">Should</span><span class="p">().</span><span class="n">BeEquivalentTo</span><span class="p">(</span>
<span class="w">    </span><span class="n">dto</span><span class="p">,</span>
<span class="w">    </span><span class="n">opt</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">opt</span><span class="p">.</span><span class="n">Excluding</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">Category</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">Excluding</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">Orders</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">Excluding</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">Id</span><span class="p">)</span>
<span class="w">        </span><span class="p">.</span><span class="n">Excluding</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">RowVersion</span><span class="p">));</span>
<span class="n">p</span><span class="p">.</span><span class="n">Category</span><span class="p">.</span><span class="n">Should</span><span class="p">().</span><span class="n">NotBeNull</span><span class="p">();</span>
<span class="n">p</span><span class="p">.</span><span class="n">Category</span><span class="p">.</span><span class="n">Id</span><span class="p">.</span><span class="n">Should</span><span class="p">().</span><span class="n">Be</span><span class="p">(</span><span class="n">dto</span><span class="p">.</span><span class="n">CategoryId</span><span class="p">);</span>
<span class="n">p</span><span class="p">.</span><span class="n">Orders</span><span class="p">.</span><span class="n">Should</span><span class="p">().</span><span class="n">BeEmpty</span><span class="p">();</span>
<span class="n">p</span><span class="p">.</span><span class="n">Id</span><span class="p">.</span><span class="n">Should</span><span class="p">().</span><span class="n">BeGreaterThan</span><span class="p">(</span><span class="m">0</span><span class="p">);</span>
<span class="n">p</span><span class="p">.</span><span class="n">RowVersion</span><span class="p">.</span><span class="n">Should</span><span class="p">().</span><span class="n">NotBeEmpty</span><span class="p">();</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Fluent Assertions és Nullable Reference Types</p>
<p>A Fluent Assertions (nem preview verziója) <a href="https://github.com/fluentassertions/fluentassertions/issues/1115">jelenleg még nem működik együtt</a> a nem nullozható referencia típusokkal kapcsolatos ellenőrzési logikákkal, így az <em>Assert</em> részen kaphatunk ennek kapcsán figyelmeztetéseket <code>Should().NotBeNull()</code> hívások után is.</p>
</div>
<p>A POST művelet megváltoztatná az adatbázis állapotát, amit célszerű lenne elkerülni.
Ezt legegyszerűbben úgy érhetjük el, hogy nyitunk egy tranzakciót a tesztben, amit nem commitolunk a teszt lefutása során. Ehhez vegyük fel az alábbi utasításokat az <em>Arrange</em> fázisban.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Arrange</span>
<span class="hll"><span class="n">_appFactory</span><span class="p">.</span><span class="n">Server</span><span class="p">.</span><span class="n">PreserveExecutionContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
</span><span class="hll"><span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">tran</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TransactionScope</span><span class="p">(</span><span class="n">TransactionScopeAsyncFlowOption</span><span class="p">.</span><span class="n">Enabled</span><span class="p">);</span>
</span>
<span class="kt">var</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_appFactory</span><span class="p">.</span><span class="n">CreateClient</span><span class="p">();</span>
<span class="kt">var</span><span class="w"> </span><span class="n">dto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_dtoFaker</span><span class="p">.</span><span class="n">Generate</span><span class="p">();</span>
</code></pre></div>
<p>Tranzakciót a .NET <code>TransactionScope</code> osztállyal fogunk most nyitni, amin engedélyezzük az aszinkron támogatást is.
Ahhoz pedig, hogy a tesztben létrehozott tranzakció érvényre jusson a teszt szerveren is, a <code>PreserveExecutionContext</code> tulajdonságot be kell kapcsoljuk.</p>
<p>Próbáljuk ki a menu:Test[Run All Test] menüpont segítségével.
A <a href="https://learn.microsoft.com/en-us/visualstudio/test/run-unit-tests-with-test-explorer?view=vs-2022#run-tests-in-test-explorer">Test Explorerben</a> figyeljük meg az eredményt.</p>
<h3 id="post-muvelet-hibaag-tesztelese">POST művelet hibaág tesztelése<a class="headerlink" href="#post-muvelet-hibaag-tesztelese" title="Permanent link">¶</a></h3>
<p>Készítsünk egy tesztesetet, ami a hibás terméknév ágat teszteli le.
Mivel ez két esetet is magában foglal (null, üres string), használjunk paraméterezhető tesztesetet, tehát <code>Theory</code>-t.
A teszteset bemenő paramétereit többféleképpen is meg lehet adni.
Mi most válasszuk az <code>InlineData</code> megközelítést, ahol attribútumokkal a teszteset fölött közvetlenül megadhatóak a bemenő paraméter értékei.
Ilyen esetben az attribútumban megadott értékeket a teszt metódus paraméterlistáján kell elkérjük.
Esetünkben a név hibás értékeit várjuk első paraméterként, második paraméterként pedig az elvárt hibaüzenetet.</p>
<div class="highlight"><pre><span></span><code><span class="na">[Theory]</span>
<span class="na">[InlineData("", "Product name is required.")]</span>
<span class="na">[InlineData(null, "Product name is required.")]</span>
<span class="k">public</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="n">Task</span><span class="w"> </span><span class="nf">Should_Fail_When_Name_Is_Invalid</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">expectedError</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// Arrange</span>

<span class="w">    </span><span class="c1">// Act</span>

<span class="w">    </span><span class="c1">// Assert</span>
<span class="p">}</span>
</code></pre></div>
<p>Az előző tesztesethez hasonlóan hozzunk létre a teszt szervert és a DTO-t, de most a nevet a paraméter alapján töltsük fel.
Bár elvileg nem lenne szükséges tranzakciókezelés, hiszen nem szabadna adatbázis módosításnak történnie, a biztonság kedvéért implementáljuk itt is a tranzakciókezelést.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Arrange</span>
<span class="w"> </span><span class="n">_appFactory</span><span class="p">.</span><span class="n">Server</span><span class="p">.</span><span class="n">PreserveExecutionContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="nn">var</span><span class="w"> </span><span class="n">tran</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">TransactionScope</span><span class="p">(</span><span class="n">TransactionScopeAsyncFlowOption</span><span class="p">.</span><span class="n">Enabled</span><span class="p">);</span>
<span class="kt">var</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_appFactory</span><span class="p">.</span><span class="n">CreateClient</span><span class="p">();</span>
<span class="kt">var</span><span class="w"> </span><span class="n">dto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_dtoFaker</span><span class="p">.</span><span class="n">RuleFor</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">).</span><span class="n">Generate</span><span class="p">();</span>
</code></pre></div>
<p>Az <em>Act</em> fázisban annyi a különbség, hogy most <code>ValidationProblemDetails</code> objektumot várunk a válaszban.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Act</span>
<span class="kt">var</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="n">client</span><span class="p">.</span><span class="n">PostAsJsonAsync</span><span class="p">(</span><span class="s">"/api/products"</span><span class="p">,</span><span class="w"> </span><span class="n">dto</span><span class="p">,</span><span class="w"> </span><span class="n">_serializerOptions</span><span class="p">);</span>
<span class="kt">var</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="n">response</span><span class="p">.</span><span class="n">Content</span>
<span class="w">    </span><span class="p">.</span><span class="n">ReadFromJsonAsync</span><span class="o">&lt;</span><span class="n">ValidationProblemDetails</span><span class="o">&gt;</span><span class="p">(</span><span class="n">_serializerOptions</span><span class="p">);</span>
</code></pre></div>
<p>Az <em>Assert</em> fázisban pedig a HTTP státuszkódot és a <code>ProblemDetails</code> tartalmára vizsgáljunk.</p>
<div class="highlight"><pre><span></span><code><span class="c1">// Assert</span>
<span class="n">response</span><span class="p">.</span><span class="n">StatusCode</span><span class="p">.</span><span class="n">Should</span><span class="p">().</span><span class="n">Be</span><span class="p">(</span><span class="n">HttpStatusCode</span><span class="p">.</span><span class="n">BadRequest</span><span class="p">);</span>

<span class="n">p</span><span class="p">.</span><span class="n">Status</span><span class="p">.</span><span class="n">Should</span><span class="p">().</span><span class="n">Be</span><span class="p">(</span><span class="m">400</span><span class="p">);</span>
<span class="n">p</span><span class="p">.</span><span class="n">Errors</span><span class="p">.</span><span class="n">Should</span><span class="p">().</span><span class="n">HaveCount</span><span class="p">(</span><span class="m">1</span><span class="p">);</span>
<span class="n">p</span><span class="p">.</span><span class="n">Errors</span><span class="p">.</span><span class="n">Should</span><span class="p">().</span><span class="n">ContainKey</span><span class="p">(</span><span class="n">nameof</span><span class="p">(</span><span class="n">Product</span><span class="p">.</span><span class="n">Name</span><span class="p">));</span>
<span class="n">p</span><span class="p">.</span><span class="n">Errors</span><span class="p">[</span><span class="n">nameof</span><span class="p">(</span><span class="n">Product</span><span class="p">.</span><span class="n">Name</span><span class="p">)].</span><span class="n">Should</span><span class="p">().</span><span class="n">ContainSingle</span><span class="p">(</span><span class="n">expectedError</span><span class="p">);</span>
</code></pre></div>
<p>Próbáljuk ki a menu:Test[Run All Test] menüpont segítségével.
Figyeljük meg a tesztek hierarchiáját is, a POST művelethez kapcsolódó tesztek egy csoportba lettek összefogva a beágyazott osztály mentén.</p>
<div class="admonition tip">
<p class="admonition-title">Transzakciókezelés kódduplikáció</p>
<p>Észrevehetjük, hogy a tranzakciókezeléssel kapcsolatos kódot duplikáltuk, ennek elkerülésére például <a href="https://github.com/xunit/samples.xunit/blob/main/AutoRollbackExample/AutoRollbackAttribute.cs">például tesztfüggvényre tehető attribútumot</a> vezethetünk be.</p>
</div>
<h2 id="naplozas">Naplózás<a class="headerlink" href="#naplozas" title="Permanent link">¶</a></h2>
<p>A tesztek üzeneteket naplózhatnak egy speciális tesztkimenetre.
Ehhez minden tesztosztály példány kap(hat) egy saját <code>ITestOutputHelper</code> példányt a konstruktoron keresztül.
Vezessük be az új konstruktorparamétert a tesztosztályban és az ősosztályában is.</p>
<div class="highlight"><pre><span></span><code><span class="hll"><span class="k">private</span><span class="w"> </span><span class="k">readonly</span><span class="w"> </span><span class="n">ITestOutputHelper</span><span class="w"> </span><span class="n">_testOutput</span><span class="p">;</span>
</span>
<span class="k">public</span><span class="w"> </span><span class="nf">ProductControllerTests</span><span class="p">(</span>
<span class="w">    </span><span class="n">CustomWebApplicationFactory</span><span class="w"> </span><span class="n">appFactory</span><span class="p">,</span>
<span class="hll"><span class="w">    </span><span class="n">ITestOutputHelper</span><span class="w"> </span><span class="n">output</span><span class="p">)</span>
</span><span class="p">{</span>
<span class="w">    </span><span class="c1">//...</span>
<span class="hll"><span class="w">    </span><span class="n">_testOutput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">output</span><span class="p">;</span>
</span><span class="p">}</span>
</code></pre></div>
<div class="highlight"><span class="filename">Post beágyazott típus konstruktora</span><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="nf">Post</span><span class="p">(</span><span class="n">CustomWebApplicationFactory</span><span class="w"> </span><span class="n">appFactory</span><span class="p">,</span><span class="w"> </span><span class="n">ITestOutputHelper</span><span class="w"> </span><span class="n">output</span><span class="p">)</span>
<span class="w">    </span><span class="p">:</span><span class="w"> </span><span class="k">base</span><span class="p">(</span><span class="n">appFactory</span><span class="p">,</span><span class="w"> </span><span class="n">output</span><span class="p">)</span>
<span class="p">{</span><span class="w"> </span><span class="p">}</span>
</code></pre></div>
<p>Próbaképp írjunk ki egy üzenetet a <code>ProductControllerTests</code> konstruktorában.</p>
<div class="highlight"><pre><span></span><code><span class="n">output</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="s">"ProductControllerTests ctor"</span><span class="p">);</span>
</code></pre></div>
<p>Ellenőrizzük, hogy a tesztek lefuttatása után <em>Test Explorer</em>-ben megjelennek-e az üzenetek a <a href="https://learn.microsoft.com/en-us/visualstudio/test/run-unit-tests-with-test-explorer?view=vs-2022#view-test-details"><em>Test Detail Summary</em></a> ablakrész <em>Standard output</em> szekciójában.
Ebből láthatjuk, hogy minden tesztfüggvény, sőt minden tesztfüggvény változat (a <em>Theory</em> minden bemeneti adatsora egy külön változat) meghívásakor lefut a konstruktor.</p>
<p>Ugyanerre a kimenetre kössük rá a szerveroldali naplózást, hogy a tesztek lefutása mellett ezek a naplóüzenetek is megjelenjenek.
Ehhez telepítsünk egy segédcsomagot a tesztprojektbe.</p>
<div class="highlight"><pre><span></span><code><span class="nt">&lt;PackageReference</span><span class="w"> </span><span class="na">Include=</span><span class="s">"MartinCostello.Logging.XUnit"</span><span class="w"> </span><span class="na">Version=</span><span class="s">"0.3.0"</span><span class="w"> </span><span class="nt">/&gt;</span>
</code></pre></div>
<p>A <code>ProductControllerTests</code> konstruktorában kössük össze a két paramétert, a <code>CustomWebApplicationFactory</code> és az <code>ITestOutputHelper</code> példányt a fenti segédcsomag (<code>AddXUnit</code> metódus) segítségével.
A tesztszerver naplózó alrendszerének adjuk meg kimenetként az xUnit tesztkimenetét.</p>
<div class="highlight"><pre><span></span><code><span class="n">_appFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">appFactory</span>
<span class="w">    </span><span class="p">.</span><span class="n">WithWebHostBuilder</span><span class="p">(</span><span class="n">builder</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">builder</span><span class="p">.</span><span class="n">ConfigureLogging</span><span class="p">(</span><span class="n">logging</span><span class="w"> </span><span class="o">=&gt;</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="n">logging</span><span class="p">.</span><span class="n">ClearProviders</span><span class="p">();</span>
<span class="w">            </span><span class="n">logging</span><span class="p">.</span><span class="n">AddXUnit</span><span class="p">(</span><span class="n">output</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">});</span>
</code></pre></div>
<p>Ellenőrizzük, hogy a tesztek lefuttatása után <em>Test Explorer</em>-ben megjelennek-e a szerveroldali üzenetek is.</p>
<p>A végállapot elérhető a kapcsolódó GitHub repóban.</p>
<hr/>
<div class="md-source-file">
<span class="md-source-file__fact"> <span class="md-icon" title="Utolsó frissítés"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z">
</path>
</svg>
</span>
<span title="2024. június 25. 10:38:05">
<span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago"><span class="timeago" datetime="2024-06-25T10:38:05+02:00" locale="hu"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date">2024-06-25</span>
</span>
</span>
<span class="md-source-file__fact">
<span class="md-icon" title="Szerzők">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z">
</path>
</svg>
</span>
<span>Szerzők</span>
<nav><a class="md-author" href="https://github.com/tibitoth" rel="noopener noreferrer" target="_blank" title="@Tibor Tóth">
<img alt="@Tibor Tóth" src="https://avatars.githubusercontent.com/u/8333960?u=d26653213d265ecdceeaf20a896d74f479d35450&amp;v=4?size=72"/>
</a></nav>
</span>
</div>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"></path></svg>
  Vissza a tetejére
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright © BME VIK AUT
    </div>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.top", "search.suggest", "content.action.edit", "content.code.annotate", "toc.follow"], "search": "../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "V\u00e1g\u00f3lapra m\u00e1solva", "clipboard.copy": "M\u00e1sol\u00e1s v\u00e1g\u00f3lapra", "search.result.more.one": "1 tov\u00e1bbi tal\u00e1lat az oldalon", "search.result.more.other": "# tov\u00e1bbi tal\u00e1lat az oldalon", "search.result.none": "Nincs tal\u00e1lat", "search.result.one": "1 egyez\u0151 dokumentum", "search.result.other": "# egyez\u0151 dokumentum", "search.result.placeholder": "Keres\u00e9shez \u00edrj ide valamit", "search.result.term.missing": "\u00dcres", "select.version": "Verzi\u00f3v\u00e1lt\u00e1s"}}</script>
<script src="../../../assets/javascripts/bundle.ad660dcc.min.js"></script>
<script src="../../../js/timeago.min.js"></script>
<script src="../../../js/timeago_mkdocs_material.js"></script>
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>